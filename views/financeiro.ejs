<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Financeiro – 
    <% if (monthLabel) { %><%= monthLabel %>
    <% } else if (weekLabel) { %><%= weekLabel %>
    <% } else { %>Geral<% } %>
  </title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">
      Financeiro –
      <% if (monthLabel) { %><%= monthLabel %>
      <% } else if (weekLabel) { %><%= weekLabel %>
      <% } else { %>Geral<% } %>
    </h1>

    <form method="GET" action="/financeiro" class="flex flex-wrap items-center gap-4 mb-6">
      <div>
        <label class="font-semibold">Mês:</label>
        <input type="month" name="month" value="<%= monthValue %>"
               class="p-2 border rounded">
      </div>
      <div>
        <label class="font-semibold">Semana:</label>
        <input type="week" name="week" value="<%= weekValue %>"
               class="p-2 border rounded">
      </div>
      <button type="submit"
              class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
        Filtrar
      </button>
    </form>

    <!-- Total Geral -->
    <div class="mb-6 p-4 bg-gray-50 rounded">
      <h2 class="text-lg font-semibold text-gray-800">Total Geral Recebido</h2>
      <p class="mt-1 text-2xl font-bold text-gray-900">
        R$ <%= overallTotal.toFixed(2) %>
      </p>
    </div>

    <!-- Cards por forma -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <% ['Pix','Dinheiro','Cartão'].forEach(method => {
           const total = totals[method] || 0;
           const bg    = method==='Pix' ? 'bg-green-100'
                      : method==='Dinheiro' ? 'bg-yellow-100'
                      : 'bg-blue-100';
           const tc    = method==='Pix' ? 'text-green-800'
                      : method==='Dinheiro' ? 'text-yellow-800'
                      : 'text-blue-800';
      %>
        <div class="p-4 rounded <%= bg %>">
          <h3 class="font-semibold <%= tc %>">Recebido via <%= method %></h3>
          <p class="mt-1 text-xl font-bold">R$ <%= total.toFixed(2) %></p>
        </div>
      <% }) %>
    </div>

    <!-- Detalhes -->
    <% ['Pix','Dinheiro','Cartão'].forEach(method => {
         const list = details[method] || [];
    %>
      <section class="mb-8">
        <h4 class="text-lg font-medium mb-2">Detalhes – <%= method %></h4>
        <% if (list.length) { %>
          <ul class="space-y-2">
            <% list.forEach(d => { %>
              <li class="p-4 bg-gray-50 rounded border">
                <strong><%= d.date %> – <%= d.client %> – <%= d.item %>: R$ <%= d.amount %></strong>
                <% if (d.description) { %>
                  <p class="text-sm italic text-gray-700 mt-1"><%= d.description %></p>
                <% } %>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <p class="text-gray-500">Nenhum pagamento via <%= method %>.</p>
        <% } %>
      </section>
    <% }) %>

    <a href="/" class="inline-block mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
      ⬅ Voltar
    </a>
  </div>
</body>
</html>
